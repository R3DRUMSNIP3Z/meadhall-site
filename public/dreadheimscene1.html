<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Veriador • Dreadheim • Scene 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  font-family: Cinzel, serif;
  overflow: hidden;
}

/* Background */
#bg {
  position: fixed;
  inset: 0;
  background: url("/guildbook/scenes/dreadheim_scene1.png") center center / cover no-repeat;
  z-index: 0;
}

/* Dialogue UI */
#dlg {
  position: fixed;
  left: 50%;
  bottom: 14px;
  transform: translateX(-50%);
  width: min(1200px, calc(100vw - 24px));
  height: 190px;
  z-index: 10;
  display: grid;
  grid-template-columns: 240px 1fr;
  border-radius: 18px;
  overflow: hidden;
  background: linear-gradient(90deg, rgba(35,20,10,.95), rgba(15,10,8,.88));
  border: 1px solid rgba(255,208,120,.2);
  box-shadow: 0 18px 55px rgba(0,0,0,.6);
}

.hidden { display: none; }

#dlgPortrait {
  width: 240px;
  height: 190px;
  object-fit: contain;
  align-self: end;
  display: block;
}

/* Optional subtle “alive” motion even for PNG/GIF */
#dlgPortrait {
  opacity: 0;
  transform: translateY(6px) scale(0.98);
  animation:
    portraitIn 0.6s ease forwards,
    idleBreath 4s ease-in-out infinite,
    divineGlow 3.5s ease-in-out infinite;
  filter: drop-shadow(0 12px 22px rgba(0,0,0,0.65));
}

@keyframes portraitIn {
  to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes idleBreath {
  0%, 100% { transform: translateY(0) scale(1); }
  50%      { transform: translateY(-2px) scale(1.01); }
}
@keyframes divineGlow {
  0%, 100% { filter: drop-shadow(0 12px 22px rgba(0,0,0,0.6)); }
  50%      { filter: drop-shadow(0 12px 30px rgba(180,200,255,0.65)); }
}

#dlgPanel {
  padding: 16px 18px;
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 10px;
}

#dlgName {
  font-size: 28px;
  font-weight: 900;
  color: rgba(255,225,170,.95);
}

#dlgText {
  font-size: 20px;
  line-height: 1.35;
  color: rgba(255,255,255,.95);
}

#dlgBtns {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  flex-wrap: wrap;
}

.dlgBtn {
  padding: 10px 16px;
  border-radius: 12px;
  cursor: pointer;
  border: 1px solid rgba(255,208,120,.28);
  background: rgba(120,60,25,.45);
  color: rgba(255,245,230,.95);
  font-weight: 800;
}

.dlgBtn:hover { filter: brightness(1.1); }
</style>
</head>

<body>
<div id="bg"></div>

<!-- Dialogue UI -->
<div id="dlg" class="hidden">
  <img id="dlgPortrait" alt="Loki">
  <div id="dlgPanel">
    <div id="dlgName"></div>
    <div id="dlgText"></div>
    <div id="dlgBtns"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  const NAME_KEY = "va_player_name";
  const ALIGN_KEY = "va_alignment";

  // Dreadheim speaker + portrait
  const LOKI_NAME = "Loki";
  const LOKI_PORTRAIT = "/guildbook/npcs/loki.gif"; // change to .png if you want

  // Optional: if someone lands here without being dreadheim, redirect them
  const align = localStorage.getItem(ALIGN_KEY) || "";
  if (align && align !== "dreadheim") {
    window.location.href = "/myriadorscene1.html";
    return;
  }

  const dlg = document.getElementById("dlg");
  const dlgName = document.getElementById("dlgName");
  const dlgText = document.getElementById("dlgText");
  const dlgBtns = document.getElementById("dlgBtns");
  const dlgPortrait = document.getElementById("dlgPortrait");

  // Always show Loki portrait
  dlgPortrait.src = LOKI_PORTRAIT;
  dlgPortrait.style.display = "block";

  let playerName = localStorage.getItem(NAME_KEY) || "Traveler";

  function showDialogue({ name, text, buttons = [] }) {
    dlgName.textContent = name || LOKI_NAME;
    dlgText.innerHTML = "";
    dlgBtns.innerHTML = "";
    dlg.classList.remove("hidden");

    dlgPortrait.src = LOKI_PORTRAIT;
    dlgPortrait.style.display = "block";

    dlgText.textContent = text;

    buttons.forEach(b => {
      const btn = document.createElement("button");
      btn.className = "dlgBtn";
      btn.textContent = b.label;
      btn.onclick = b.onClick;
      dlgBtns.appendChild(btn);
    });
  }

  function hideDialogue() {
    dlg.classList.add("hidden");
  }

  // Scene content (same structure as Episode I: showDialogue with buttons)
  const lines = [
    `So… ${playerName}.`,
    "You chose Dreadheim. Bold. Or foolish.",
    "This land doesn’t reward courage. It rewards the clever.",
    "Tell me—do you want truth… or power?"
  ];

  let i = 0;

  function showNext() {
    const text = lines[i] || "Good.";
    const isLast = i >= lines.length - 1;

    showDialogue({
      name: LOKI_NAME,
      text,
      buttons: isLast ? [
        {
          label: "Enter Dreadheim",
          onClick: () => {
            hideDialogue();
            // Next page after scene 1 (change later)
            window.location.href = "/dreadheimscene2.html";
          }
        }
      ] : [
        {
          label: "Continue",
          onClick: () => {
            i += 1;
            showNext();
          }
        }
      ]
    });
  }

  showNext();

  // ===============================
  // DEV TOOLS (F12)
  // ===============================
  window.VA_DEV = window.VA_DEV || {};
  window.VA_DEV.gotoDreadheimScene1 = () => window.location.href = "/dreadheimscene1.html";

});
</script>
</body>
</html>


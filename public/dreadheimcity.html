```html
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Veriador â€¢ Dreadheim â€¢ City</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;800;900&display=swap" rel="stylesheet">

<style>
html, body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  font-family:Cinzel, serif;
  overflow:hidden;
}

/* ================= BACKGROUND ================= */
#bg{
  position:fixed;
  inset:0;
  background:url("/guildbook/scenes/maps/dreadheimcityentrance.png") center center / cover no-repeat;
  z-index:0;
}

/* Optional subtle vignette */
#vignette{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:5;
  background:radial-gradient(ellipse at center,
    rgba(0,0,0,0.00) 0%,
    rgba(0,0,0,0.25) 55%,
    rgba(0,0,0,0.65) 100%);
}

/* ================= NPCS LAYER ================= */
#npcs{
  position:fixed;
  inset:0;
  z-index:20;
  pointer-events:none; /* allow only NPCs to receive clicks */
}

/* ================= NPC WRAPS (drag + resize) ================= */
.npcWrap{
  position:absolute;
  z-index:25;
  pointer-events:auto;
  user-select:none;
  cursor:pointer;
  filter: drop-shadow(0 18px 32px rgba(0,0,0,0.78));
  transition: filter 120ms ease;
}
.npcWrap:hover{
  filter: drop-shadow(0 22px 38px rgba(0,0,0,0.85))
          drop-shadow(0 0 14px rgba(180,200,255,0.18));
}

/* image fills the wrap width */
.npcImg{
  width:100%;
  height:auto;
  display:block;
  pointer-events:auto;
}

/* DEV visuals */
body.devMode .npcWrap{
  outline:1px dashed rgba(255,215,140,0.65);
  cursor:move;
}

.npcWrap.dragging{
  outline:2px dashed rgba(255,215,140,.9) !important;
  box-shadow:0 0 0 6px rgba(255,215,140,.12), 0 18px 55px rgba(0,0,0,.60) !important;
}

/* resize handle (bottom-right) */
.npcHandle{
  position:absolute;
  right:-6px;
  bottom:-6px;
  width:16px;
  height:16px;
  border-radius:6px;
  border:1px solid rgba(255,215,140,0.85);
  background:rgba(0,0,0,0.55);
  box-shadow:0 10px 22px rgba(0,0,0,0.6);
  cursor:nwse-resize;
  display:none; /* only in dev mode */
}
body.devMode .npcHandle{ display:block; }

/* ================= DIALOGUE ================= */
#dlg{
  position:fixed;
  left:50%;
  bottom:14px;
  transform:translateX(-50%);
  width:min(1200px, calc(100vw - 24px));
  height:190px;
  z-index:999; /* keep above everything */
  display:grid;
  grid-template-columns:240px 1fr;
  border-radius:18px;
  overflow:hidden;
  background:linear-gradient(90deg, rgba(35,20,10,.95), rgba(15,10,8,.88));
  border:1px solid rgba(255,208,120,.2);
  box-shadow:0 18px 55px rgba(0,0,0,.6);
}
#dlg.hidden{ display:none !important; }

#dlgPortrait{
  width:240px;
  height:190px;
  object-fit:contain;
  align-self:end;
  filter:drop-shadow(0 12px 22px rgba(0,0,0,0.65));
}

#dlgPanel{
  padding:16px 18px;
  display:grid;
  grid-template-rows:auto minmax(0, 1fr) auto; /* scroll-safe */
  gap:10px;
  min-height:0;
}

#dlgName{
  font-size:28px;
  font-weight:900;
  color:rgba(255,225,170,.95);
}

#dlgText{
  font-size:20px;
  line-height:1.35;
  color:rgba(255,255,255,.95);
  overflow:auto;
  min-height:0;
  padding-right:6px;
}

#dlgBtns{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  flex-wrap:wrap;
}

#dlg, #dlgPanel, #dlgBtns, .dlgBtn{ pointer-events:auto; }

.dlgBtn{
  padding:10px 16px;
  border-radius:12px;
  cursor:pointer;
  border:1px solid rgba(255,208,120,.28);
  background:rgba(120,60,25,.45);
  color:rgba(255,245,230,.95);
  font-weight:800;
}
.dlgBtn:hover{ filter:brightness(1.1); }

/* Tiny hint text */
#hint{
  position:fixed;
  left:14px;
  bottom:14px;
  z-index:15;
  font-size:14px;
  letter-spacing:.03em;
  color:rgba(255,255,255,0.55);
  text-shadow:0 2px 10px rgba(0,0,0,0.8);
  pointer-events:none;
}

/* ================= OVERLAY HAMBURGER MENU (Mead Hall style) ================= */
#menuBtn{
  position:fixed;
  top:14px;
  left:14px;
  width:52px;
  height:52px;
  background:transparent;
  border:none;
  cursor:pointer;
  z-index:95;
  display:block;
}
#menuBtn svg{
  width:100%;
  height:100%;
  filter:drop-shadow(0 10px 22px rgba(0,0,0,0.75));
  opacity:.96;
  transition:transform 120ms ease;
}
#menuBtn:hover svg{ transform:scale(1.05); }

#menuOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  z-index:94;
  display:none;
}

#menuPanel{
  position:fixed;
  top:14px;
  left:72px; /* 52px button + gap */
  width:min(340px, calc(100vw - 86px));
  max-height:calc(100vh - 28px);
  overflow:auto;
  border-radius:18px;
  border:1px solid rgba(255,215,140,.22);
  background:linear-gradient(180deg, rgba(18,10,8,.92), rgba(0,0,0,.86));
  box-shadow:0 18px 60px rgba(0,0,0,.75);
  padding:12px;

  transform:translateX(-10px);
  opacity:0;
  transition:transform 140ms ease, opacity 140ms ease;
}
#menuOverlay.show #menuPanel{
  transform:translateX(0);
  opacity:1;
}

.menuHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.menuTitle{
  font-weight:900;
  letter-spacing:.10em;
  color:rgba(255,215,140,1);
}
#menuClose{
  width:34px;
  height:34px;
  border-radius:10px;
  font-size:20px;
  font-weight:900;
  cursor:pointer;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(255,215,140,.6);
  color:rgba(255,215,140,1);
}

.menuList{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.menuItem{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.35);
  cursor:pointer;
  user-select:none;
  color:rgba(245,240,230,.95);
  font-weight:900;
  letter-spacing:.04em;
}
.menuItem:hover{ filter:brightness(1.08); }
.menuHint{
  font-size:12px;
  opacity:.75;
  font-weight:800;
}
</style>
</head>

<body>
<div id="bg"></div>
<div id="vignette"></div>

<!-- ================= HAMBURGER MENU (placeholders) ================= -->
<button id="menuBtn" aria-label="Open scene menu" title="Menu">
  <svg viewBox="0 0 64 64" aria-hidden="true">
    <rect x="14" y="18" width="36" height="5" rx="2.5" fill="rgba(255,215,140,0.95)"></rect>
    <rect x="14" y="29.5" width="36" height="5" rx="2.5" fill="rgba(255,215,140,0.95)"></rect>
    <rect x="14" y="41" width="36" height="5" rx="2.5" fill="rgba(255,215,140,0.95)"></rect>
  </svg>
</button>

<div id="menuOverlay" aria-hidden="true">
  <div id="menuPanel" role="dialog" aria-label="Scene rooms menu">
    <div class="menuHeader">
      <div class="menuTitle">ROOMS</div>
      <button id="menuClose" aria-label="Close menu">âœ•</button>
    </div>

    <div class="menuList" id="menuList">
      <!-- âœ… placeholders: change text + data-href -->
      <div class="menuItem" data-href="/dreadheimcity.html">
        Dreadheim City <span class="menuHint">You are here</span>
      </div>

      <div class="menuItem" data-href="/dreadheim_meadhall.html">
        Placeholder 1 <span class="menuHint">room</span>
      </div>

      <div class="menuItem" data-href="/lokisroom.html">
        Placeholder 2 <span class="menuHint">room</span>
      </div>

      <div class="menuItem" data-href="/guildbook/scenes/placeholder3.html">
        Placeholder 3 <span class="menuHint">room</span>
      </div>

      <div class="menuItem" data-href="/guildbook/scenes/maps/veriador_map.html">
        World Map <span class="menuHint">map</span>
      </div>
    </div>
  </div>
</div>

<!-- ================= NPCS ================= -->
<div id="npcs">
  <!-- Replace these with your real NPC PNGs later -->
  <div class="npcWrap" data-id="1" style="left:18%; top:56%; width:190px;">
    <img class="npcImg" id="npcCitizen1" src="/guildbook/npcs/slaves/blondeman.gif" alt="slave">
    <div class="npcHandle" title="Resize"></div>
  </div>

  <div class="npcWrap" data-id="2" style="left:46%; top:60%; width:190px;">
    <img class="npcImg" id="npcCitizen2" src="/guildbook/npcs/slaves/hungrywoman.gif" alt="slave">
    <div class="npcHandle" title="Resize"></div>
  </div>

  <div class="npcWrap" data-id="3" style="left:73%; top:58%; width:190px;">
    <img class="npcImg" id="npcCitizen3" src="/guildbook/npcs/citizens/helcitizenwoman.gif" alt="Citizen">
    <div class="npcHandle" title="Resize"></div>
  </div>

  <div class="npcWrap" data-id="4" style="left:82%; top:58%; width:190px;">
    <img class="npcImg" id="npcCitizen4" src="/guildbook/npcs/citizens/helcitizenman.gif" alt="Citizen">
    <div class="npcHandle" title="Resize"></div>
  </div>
</div>

<div id="hint">Tip: Click a citizen/Slave.</div>

<!-- Dialogue -->
<div id="dlg" class="hidden">
  <img id="dlgPortrait" alt="Portrait">
  <div id="dlgPanel">
    <div id="dlgName"></div>
    <div id="dlgText"></div>
    <div id="dlgBtns"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  "use strict";

  // ----------------------------
  // Overlay Hamburger Menu
  // ----------------------------
  const menuBtn = document.getElementById("menuBtn");
  const menuOverlay = document.getElementById("menuOverlay");
  const menuClose = document.getElementById("menuClose");

  function openMenu(){
    menuOverlay.style.display = "block";
    menuOverlay.classList.add("show");
    menuOverlay.setAttribute("aria-hidden","false");
  }
  function closeMenu(){
    menuOverlay.classList.remove("show");
    menuOverlay.style.display = "none";
    menuOverlay.setAttribute("aria-hidden","true");
  }

  menuBtn.addEventListener("click", (e) => { e.preventDefault(); openMenu(); });
  menuClose.addEventListener("click", (e) => { e.preventDefault(); closeMenu(); });

  menuOverlay.addEventListener("click", (e) => {
    if (e.target === menuOverlay) closeMenu();
  });

  document.querySelectorAll("#menuList .menuItem").forEach(item => {
    item.addEventListener("click", () => {
      const href = item.getAttribute("data-href");
      if (href) window.location.href = href;
    });
  });

  // ----------------------------
  // Dialogue refs
  // ----------------------------
  const dlg = document.getElementById("dlg");
  const dlgName = document.getElementById("dlgName");
  const dlgText = document.getElementById("dlgText");
  const dlgBtns = document.getElementById("dlgBtns");
  const dlgPortrait = document.getElementById("dlgPortrait");

  function showDialogue({ speaker, text, portraitSrc, buttons = [] }){
    dlgName.textContent = speaker || "";
    dlgText.textContent = (typeof text === "string") ? text : String(text ?? "");
    dlgBtns.innerHTML = "";
    if (portraitSrc) dlgPortrait.src = portraitSrc;
    dlg.classList.remove("hidden");

    buttons.forEach(b => {
      const btn = document.createElement("button");
      btn.className = "dlgBtn";
      btn.type = "button";
      btn.textContent = b.label;

      btn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (typeof b.onClick === "function") b.onClick();
      });

      dlgBtns.appendChild(btn);
    });
  }

  function hideDialogue(){
    dlg.classList.add("hidden");
    dlgName.textContent = "";
    dlgText.textContent = "";
    dlgBtns.innerHTML = "";
  }

  hideDialogue();

  // ----------------------------
  // Require VAQ (global UI file) for flags/quest steps
  // ----------------------------
  function ensureVAQ(){
    if (!window.VAQ){
      console.warn("VAQ missing. Did /guildbook/js/va_global_ui.js load?");
      return false;
    }
    return true;
  }

  // ----------------------------
  // Citizens -> quest objective flags for dq_001b
  // (matches your failedloki_quests.json flags/steps)
  // ----------------------------
  function setFlag(flagKey, value=true){
    if (!ensureVAQ()) return;
    const f = VAQ.getFlags();
    f[String(flagKey)] = value;
    VAQ.setFlags(f);
  }

  // ----------------------------
  // GOOD/EVIL meter helpers (keeps same 0..10 behavior)
  // ----------------------------
  function addGood(delta){
    if (!ensureVAQ()) return;
    delta = Number(delta)||0;
    if (!delta) return;
    const g = Math.max(0, Math.min(10, Number(localStorage.getItem("va_good")||"0")));
    const e = Math.max(0, Math.min(10, Number(localStorage.getItem("va_evil")||"0")));
    // same overflow behavior as your other pages: if good maxed, reduce evil if possible
    let ng=g, ne=e;
    for (let i=0;i<Math.abs(delta);i++){
      if (delta>0){
        if (ng>=10){
          if (ne>0) ne-=1;
        } else ng+=1;
      } else {
        if (ng>0) ng-=1;
      }
    }
    localStorage.setItem("va_good", String(ng));
    localStorage.setItem("va_evil", String(ne));
  }

  function addEvil(delta){
    if (!ensureVAQ()) return;
    delta = Number(delta)||0;
    if (!delta) return;
    const g = Math.max(0, Math.min(10, Number(localStorage.getItem("va_good")||"0")));
    const e = Math.max(0, Math.min(10, Number(localStorage.getItem("va_evil")||"0")));
    // overflow: if evil maxed, reduce good if possible
    let ng=g, ne=e;
    for (let i=0;i<Math.abs(delta);i++){
      if (delta>0){
        if (ne>=10){
          if (ng>0) ng-=1;
        } else ne+=1;
      } else {
        if (ne>0) ne-=1;
      }
    }
    localStorage.setItem("va_good", String(ng));
    localStorage.setItem("va_evil", String(ne));
  }

  function doIntimidate(){
    if (!ensureVAQ()) return;
    setFlag("dq_001b_intimidatedCitizen", true);
    VAQ.qSetStepStatus("dq_001b", 0, "pass");

    showDialogue({
      speaker: "Citizen",
      portraitSrc: "/guildbook/npcs/slaves/blondeman.gif",
      text: VAQ.txt("Y-yesâ€¦ Iâ€™ll be silent. Pleaseâ€”donâ€™t draw attention to me, {name}."),
      buttons: [{ label: "Close", onClick: hideDialogue }]
    });
  }

  // ----------------------------
  // Item: Slave's wedding ring (web path)
  // ----------------------------
  const SLAVES_RING_ITEM = {
    id: "slaves_wedding_ring",
    name: "Slaveâ€™s Wedding Ring",
    img: "/guildbook/props/slavesring.gif"
  };

  function doTake(){
    if (!ensureVAQ()) return;
    setFlag("dq_001b_stoleFromCitizen", true);
    VAQ.qSetStepStatus("dq_001b", 1, "pass");

    // EVIL point
    addEvil(1);

    // Add item + open inventory (Mead Hall behavior)
    if (typeof VAQ.invUnlock === "function") VAQ.invUnlock();
    if (typeof VAQ.invAddItem === "function") VAQ.invAddItem(SLAVES_RING_ITEM);

    showDialogue({
      speaker: "Street Slave",
      portraitSrc: "/guildbook/npcs/slaves/hungrywoman.gif",
      text: VAQ.txt("You rummage through her sack that is being used as bottom cover and find a special memento that the slaves cherishes her dead husbands wedding ring"),
      buttons: [
        {
          label: "Open Inventory",
          onClick: () => {
            hideDialogue();
            if (typeof VAQ.invOpen === "function") VAQ.invOpen();
          }
        },
        { label: "Close", onClick: hideDialogue }
      ]
    });
  }

  function doReturn(){
    if (!ensureVAQ()) return;
    setFlag("dq_001b_returnedCold", true);
    VAQ.qSetStepStatus("dq_001b", 2, "pass");

    showDialogue({
      speaker: "You",
      portraitSrc: "/guildbook/npcs/citizens/helcitizenwoman.gif",
      text: VAQ.txt("No apology. No explanation. Only the mark, and the memory of fear."),
      buttons: [
        { label: "Return (Placeholder)", onClick: () => { window.location.href = "/lokisroom.html"; } },
        { label: "Close", onClick: hideDialogue }
      ]
    });
  }

  // NPC clicks
  document.getElementById("npcCitizen1").addEventListener("click", () => {
    if (!ensureVAQ()){
      showDialogue({
        speaker: "Citizen",
        portraitSrc: "/guildbook/npcs/slaves/blondeman.gif",
        text: "VAQ missing (global ui not loaded).",
        buttons: [{ label: "Close", onClick: hideDialogue }]
      });
      return;
    }
    showDialogue({
      speaker: "Street Slave",
      portraitSrc: "/guildbook/npcs/slaves/blondeman.gif",
      text: VAQ.txt("what do you want from me, if its not food leave me alone!?"),
      buttons: [
        { label: "Intimidate", onClick: doIntimidate },
        { label: "Close", onClick: hideDialogue }
      ]
    });
  });

  document.getElementById("npcCitizen2").addEventListener("click", () => {
    if (!ensureVAQ()) return;
    showDialogue({
      speaker: "Citizen",
      portraitSrc: "/guildbook/npcs/slaves/hungrywoman.gif",
      text: VAQ.txt("Pleaseâ€¦ I have nothing worth taking."),
      buttons: [
        { label: "Take Something", onClick: doTake },
        { label: "Close", onClick: hideDialogue }
      ]
    });
  });

  document.getElementById("npcCitizen3").addEventListener("click", () => {
    if (!ensureVAQ()) return;
    showDialogue({
      speaker: "Citizen",
      portraitSrc: "/guildbook/npcs/citizens/helcitizenwoman.gif",
      text: VAQ.txt("Youâ€™ve already done enoughâ€¦ leave me be."),
      buttons: [
        { label: "Report Back (Cold)", onClick: doReturn },
        { label: "Close", onClick: hideDialogue }
      ]
    });
  });

  document.getElementById("npcCitizen4").addEventListener("click", () => {
    if (!ensureVAQ()) return;
    showDialogue({
      speaker: "Citizen",
      portraitSrc: "/guildbook/npcs/citizens/helcitizenman.gif",
      text: VAQ.txt("Keep your eyes down. Dreadheim doesnâ€™t forgive curiosity."),
      buttons: [{ label: "Close", onClick: hideDialogue }]
    });
  });

  // ============================================================
  // DEV NPC DRAG + RESIZE MODE
  // - Press M to toggle
  // - Drag .npcWrap positions
  // - Resize using bottom-right handle
  // - Saves per page (pathname) in localStorage
  // ============================================================
  (() => {
    const DEV_KEY = "va_scene_dev_mode";
    const POS_KEY = "va_scene_npc_positions_" + location.pathname;

    const wraps = Array.from(document.querySelectorAll(".npcWrap"));
    if (!wraps.length) return;

    let devMode = localStorage.getItem(DEV_KEY) === "1";

    let dragging = null;
    let resizing = null;
    let offsetX = 0;
    let offsetY = 0;

    let startW = 0;
    let startX = 0;

    function loadPositions(){
      try { return JSON.parse(localStorage.getItem(POS_KEY) || "{}"); }
      catch { return {}; }
    }
    function savePositions(pos){
      localStorage.setItem(POS_KEY, JSON.stringify(pos));
    }

    const positions = loadPositions();

    // Apply saved
    wraps.forEach(w => {
      const id = w.dataset.id || w.querySelector("img")?.id || "npc";
      w.dataset.id = id;

      const saved = positions[id];
      if (saved){
        if (saved.left)  w.style.left = saved.left;
        if (saved.top)   w.style.top  = saved.top;
        if (saved.width) w.style.width = saved.width; // px string
      }
    });

    function setDevMode(on){
      devMode = on;
      localStorage.setItem(DEV_KEY, on ? "1" : "0");
      document.body.classList.toggle("devMode", on);
      console.log(on ? "ðŸ› ï¸ NPC DEV MODE ON (drag/resize)" : "ðŸ§­ NPC DEV MODE OFF");
    }
    setDevMode(devMode);

    window.addEventListener("keydown", (e) => {
      if (e.key.toLowerCase() === "m") setDevMode(!devMode);
    });

    // DRAG start
    wraps.forEach(w => {
      w.addEventListener("mousedown", (e) => {
        if (!devMode) return;

        // if clicking handle, ignore drag (resize handles it)
        if (e.target && e.target.classList.contains("npcHandle")) return;

        dragging = w;
        const rect = w.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        w.classList.add("dragging");
        e.preventDefault();
        e.stopPropagation();
      });

      // RESIZE start
      const handle = w.querySelector(".npcHandle");
      if (handle){
        handle.addEventListener("mousedown", (e) => {
          if (!devMode) return;

          resizing = w;
          const rect = w.getBoundingClientRect();
          startW = rect.width;
          startX = e.clientX;

          w.classList.add("dragging");
          e.preventDefault();
          e.stopPropagation();
        });
      }
    });

    window.addEventListener("mousemove", (e) => {
      // Drag
      if (dragging){
        const mapRect = document.body.getBoundingClientRect();
        const x = ((e.clientX - offsetX - mapRect.left) / mapRect.width) * 100;
        const y = ((e.clientY - offsetY - mapRect.top) / mapRect.height) * 100;

        dragging.style.left = x.toFixed(2) + "%";
        dragging.style.top  = y.toFixed(2) + "%";
      }

      // Resize
      if (resizing){
        const dx = e.clientX - startX;
        const newW = Math.max(80, Math.min(520, startW + dx)); // clamp
        resizing.style.width = Math.round(newW) + "px";
      }
    });

    window.addEventListener("mouseup", () => {
      const done = dragging || resizing;
      if (!done) return;

      const id = done.dataset.id;
      positions[id] = {
        left: done.style.left,
        top: done.style.top,
        width: done.style.width
      };
      savePositions(positions);

      console.log(`ðŸ“ ${id}: left:${positions[id].left}; top:${positions[id].top}; width:${positions[id].width};`);

      done.classList.remove("dragging");
      dragging = null;
      resizing = null;
    });

    // Dev convenience
    window.VA_CITY_DEV = {
      clearNpcPositions(){
        localStorage.removeItem(POS_KEY);
        console.log("ðŸ§¹ NPC positions cleared (reload page).");
      }
    };
  })();

  // ESC closes dialogue + menu
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape"){
      hideDialogue();
      try{ closeMenu(); }catch{}
    }
  });
});
</script>

<!-- âœ… GLOBAL HUD ICONS / QUEST JOURNAL / METER / INVENTORY -->
<script src="/guildbook/js/va_global_ui.js"></script>

</body>
</html>
```





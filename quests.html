<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Valhalla Ascending ‚Äî Quests</title>

  <!-- Backend base URL (keep consistent with Arena) -->
  <meta name="api-base" content="https://meadhall-site.onrender.com" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root { --gold:#d4a94d; --bg:#0b0e10; --card:#12161a; --muted:#c7b07a; }
    *{box-sizing:border-box; -webkit-font-smoothing:antialiased;}
    body{ margin:0; min-height:100vh; background:var(--bg); color:var(--gold); font-family:"Cinzel",serif; }
    .wrap{ max-width:1080px; margin:0 auto; padding:20px; }
    h1{ margin:10px 0 16px; font-size:1.6rem; }

    .grid{ display:grid; grid-template-columns: 2fr 3fr; gap:16px; align-items:start; }
    .card{
      background:var(--card); border:1px solid #3b3325; border-radius:14px; padding:14px;
      display:flex; flex-direction:column; gap:10px;
    }
    .soft{ border:0; height:1px; background:linear-gradient(90deg,transparent,#3b3325,transparent); margin:6px 0 10px; }

    .game-btn{
      display:inline-block; padding:8px 12px; border-radius:10px;
      background:#1b2228; border:1px solid #3b3325; color:var(--gold);
      text-decoration:none; cursor:pointer; transition:.2s;
    }
    .game-btn:hover{ background:#252c32; filter:drop-shadow(0 0 4px rgba(212,169,77,.6)); }

    /* Quest list */
    .q-list{ display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:12px; }
    .q-card{
      background:#0f1215; border:1px solid #3b3325; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px;
    }
    .q-title{ font-weight:800; }
    .q-meta{ font-size:.95rem; opacity:.9; display:flex; gap:10px; flex-wrap:wrap; }
    .q-status{ font-size:.85rem; padding:2px 8px; border-radius:999px; border:1px solid #3b3325; }
    .q-actions{ display:flex; gap:8px; flex-wrap:wrap; }

    /* Detail */
    .head-row{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .muted{ opacity:.85; }
    .bar{ height:8px; background:#1b1b1b; border-radius:999px; overflow:hidden; }
    .bar > span{ display:block; height:100%; background:var(--muted); width:0%; }

    /* Top nav buttons */
    .toolbar{ display:flex; gap:8px; align-items:center; margin-bottom:10px; }
    #backToProfile{ position:fixed; top:14px; left:20px; z-index:1000; }

    /* Make back link look like button for consistency */
    #backToProfile{ background:#1b2228; border:1px solid #3b3325; color:var(--gold); padding:8px 12px; border-radius:10px; text-decoration:none; }
    #backToProfile:hover{ background:#252c32; filter:drop-shadow(0 0 4px rgba(212,169,77,.6)); }

    
  </style>
</head>
<body>
  <a id="backToProfile" href="/profile.html">‚Üê Back to Profile</a>

  <div class="wrap">
    <div class="toolbar">
      <a id="openArena" href="/arena.html" class="game-btn">‚öîÔ∏è Arena</a>
      <a id="openShop" href="/shop.html" class="game-btn">üõí Equipment Shop</a>
      <a id="openBrisingr" href="/brisingrshop.html" class="game-btn">üî• Br√≠singr Shop</a>
    </div>

    <h1>üìú Valhalla Ascending ‚Äî Quests</h1>

    <div class="grid">
      <!-- Left: Quest list -->
      <section class="card">
        <div class="head-row">
          <div style="font-weight:700">Available & Active Quests</div>
          <div class="muted" id="questCount">0 quests</div>
        </div>
        <hr class="soft"/>
        <div id="questList" class="q-list"></div>
      </section>

      <!-- Right: Quest detail -->
      <section class="card" id="detailCard">
        <div class="head-row">
          <div class="q-title" id="dTitle">Select a quest</div>
          <span id="dStatus" class="q-status muted">‚Äî</span>
        </div>
        <div class="muted" id="dSubtitle">Choose a quest from the list to view details, progress, and rewards.</div>
        <div id="dBody" style="margin-top:8px; line-height:1.5;"></div>

        <div style="margin-top:10px">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="muted">Progress</div>
            <div class="muted"><span id="dProgVal">0</span>%</div>
          </div>
          <div class="bar"><span id="dProgBar"></span></div>
        </div>

        <div style="margin-top:12px">
          <div class="muted">Rewards</div>
          <div id="dRewards">‚Äî</div>
        </div>

        <div class="q-actions" style="margin-top:12px">
          <button class="game-btn" id="btnAccept" disabled>Accept</button>
          <button class="game-btn" id="btnAbandon" disabled>Abandon</button>
          <button class="game-btn" id="btnComplete" disabled>Complete</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ===== Minimal client-side quest state (localStorage) =====
    // Data shape: { id, title, desc, status: 'available' | 'active' | 'completed', progress:0-100, rewards:{gold,xp,item?}, req?:{kills?:number,items?:number} }
    const STORAGE_KEY = 'va_quests';

    const seedQuests = [
      {
        id: 'q_intro_001',
        title: 'First Steps into Veriador',
        desc: 'Speak to the trainer in the Arena and complete one Strength training.',
        status: 'available',
        progress: 0,
        rewards: { gold: 25, xp: 25 }
      },
      {
        id: 'q_hunt_002',
        title: 'Dire Wolf Scout',
        desc: 'Prove your mettle: reach Battle Rating 50 or higher.',
        status: 'available',
        progress: 0,
        rewards: { gold: 60, xp: 40 }
      },
      {
        id: 'q_set_003',
        title: 'Dress the Part',
        desc: 'Equip any 3 gear pieces at once.',
        status: 'available',
        progress: 0,
        rewards: { gold: 100, xp: 80, item: 'mysterious-charm' }
      }
    ];

    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return seedQuests;
        const parsed = JSON.parse(raw);
        // Merge new seeds if you add more later
        const byId = Object.fromEntries(parsed.map(q => [q.id, q]));
        for (const s of seedQuests) if (!byId[s.id]) parsed.push(s);
        return parsed;
      } catch { return seedQuests; }
    }
    function save(list) { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    let quests = load();
    let selected = null;

    const elList = document.getElementById('questList');
    const elCount = document.getElementById('questCount');
    const dTitle = document.getElementById('dTitle');
    const dStatus = document.getElementById('dStatus');
    const dSubtitle = document.getElementById('dSubtitle');
    const dBody = document.getElementById('dBody');
    const dProgVal = document.getElementById('dProgVal');
    const dProgBar = document.getElementById('dProgBar');
    const dRewards = document.getElementById('dRewards');
    const btnAccept = document.getElementById('btnAccept');
    const btnAbandon = document.getElementById('btnAbandon');
    const btnComplete = document.getElementById('btnComplete');

    function badgeFor(status){
      const t = (s)=>({available:'Available',active:'Active',completed:'Completed'})[s]||'‚Äî';
      dStatus.textContent = t(status);
      dStatus.style.borderColor = status==='completed' ? '#2f5341' : '#3b3325';
    }

    function rewardText(r){
      if (!r) return '‚Äî';
      const bits = [];
      if (r.gold) bits.push(`${r.gold} gold`);
      if (r.xp) bits.push(`${r.xp} xp`);
      if (r.item) bits.push(`Item: ${r.item}`);
      return bits.join(' ¬∑ ');
    }

    function renderList(){
      elList.innerHTML = '';
      quests.forEach(q=>{
        const card = document.createElement('div');
        card.className = 'q-card';
        card.innerHTML = `
          <div class="q-title">${q.title}</div>
          <div class="q-meta">
            <span class="q-status">${q.status}</span>
            <span class="muted">Rewards: ${rewardText(q.rewards)}</span>
          </div>
          <div class="bar" aria-hidden="true"><span style="width:${q.progress||0}%"></span></div>
          <div class="q-actions">
            <button class="game-btn" data-act="view">View</button>
            ${q.status==='available' ? '<button class="game-btn" data-act="accept">Accept</button>' : ''}
            ${q.status==='active' ? '<button class="game-btn" data-act="abandon">Abandon</button>' : ''}
          </div>
        `;
        card.querySelector('[data-act="view"]').onclick = ()=>select(q.id);
        const acc = card.querySelector('[data-act="accept"]');
        if (acc) acc.onclick = ()=>accept(q.id);
        const abd = card.querySelector('[data-act="abandon"]');
        if (abd) abd.onclick = ()=>abandon(q.id);
        elList.appendChild(card);
      });
      elCount.textContent = `${quests.length} quests`;
    }

    function select(id){
      selected = quests.find(q=>q.id===id) || null;
      if (!selected){
        dTitle.textContent = 'Select a quest';
        dSubtitle.textContent = 'Choose a quest from the list to view details, progress, and rewards.';
        dBody.textContent = '';
        dRewards.textContent = '‚Äî';
        dProgVal.textContent = '0';
        dProgBar.style.width = '0%';
        btnAccept.disabled = btnAbandon.disabled = btnComplete.disabled = true;
        return;
      }
      dTitle.textContent = selected.title;
      badgeFor(selected.status);
      dSubtitle.textContent = '';
      dBody.textContent = selected.desc;
      dRewards.textContent = rewardText(selected.rewards);
      const p = selected.progress || 0;
      dProgVal.textContent = p;
      dProgBar.style.width = p + '%';

      btnAccept.disabled = !(selected.status==='available');
      btnAbandon.disabled = !(selected.status==='active');
      btnComplete.disabled = !(selected.status==='active' && (selected.progress||0) >= 100);
    }

    function accept(id){
      const q = quests.find(x=>x.id===id); if (!q) return;
      q.status = 'active'; q.progress = q.progress || 0;
      save(quests); renderList(); if (!selected || selected.id===id) select(id);
    }
    function abandon(id){
      const q = quests.find(x=>x.id===id); if (!q) return;
      q.status = 'available'; q.progress = 0;
      save(quests); renderList(); if (!selected || selected.id===id) select(id);
    }
    function complete(id){
      const q = quests.find(x=>x.id===id); if (!q) return;
      q.status = 'completed'; q.progress = 100;
      save(quests); renderList(); select(id);
      // Optional: integrate with your backend later to grant rewards.
      // For now, you can add to localStorage 'me' if you want.
      alert(`Quest completed! Rewards: ${rewardText(q.rewards)}`);
    }

    btnAccept.onclick = ()=> selected && accept(selected.id);
    btnAbandon.onclick = ()=> selected && abandon(selected.id);
    btnComplete.onclick = ()=> selected && complete(selected.id);

    // For now, auto-select first quest for convenience:
    renderList(); select(quests[0]?.id);

    // === Integration hints ===
    // ‚Ä¢ Later, you can sync quests with your backend: fetch(`${apiBase}/api/quests`)
    // ‚Ä¢ And wire progress with real game actions (e.g., on Arena train, increment q_intro_001, etc.)
  </script>
</body>
</html>
